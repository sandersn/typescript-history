<div class="wikidoc">TypeScript uses our &quot;fourslash&quot; test framework to enable validation of editor features like member listing, tooltips, and navigation. Because Visual Studio hosts the TypeScriptServices.js file to implement these features, we test directly against this .js file instead of trying to automate a heavyweight external process like Visual Studio.<br />
<h1>Basics</h1>To explain how to use and write these tests, let’s jump in with an example.<br /><br />This test verifies that the member list for a variable of an enum type doesn&#39;t list the enum members:<br /><img src="http://download-codeplex.sec.s-msft.com/Download?ProjectName=typescript&DownloadId=817494" alt="fourslash.png" title="fourslash.png" /><br /><br />The first section, highlighted here in orange, is the code section. Lines prefixed by four forward slashes are fed into a source file for the language service. Interspersed in this example is a marker, indicated by <span class="codeInline">/**/</span>. Markers will be automatically stripped from the source code, but their positions will be available to reference later. <br /><br />The second section, in blue, is the imperative section. Here, you can write any regular TypeScript code. What’s going on in this test? This test only requires two commands:<br /><pre>
goTo.marker();
</pre><br />This line moves the caret to the marker (immediately after <span class="codeInline">n</span>).<br /><pre>
verify.not.memberListContains(&#39;C&#39;);
</pre><br />Now we verify that ‘C’ does not appear in the member list (Ctrl-J in VS). If &#39;C&#39; did appear in the member list, the test would fail at this point.<br />
<h1>Adding a new test</h1>Make a new .ts file in public\tests\ls\fourslash<br />At the top of the file, add:  <span class="codeInline">/// &lt;reference path=&#39;fourslash.ts&#39; /&gt;</span><br /><br />Write your code section, with each line prefaced by <span class="codeInline">////</span>.<br /><br />Write your imperative section. All the relevant APIs are additionally exposed under the <span class="codeInline">fs</span> object if you need help locating a particular method.<br />
<h1>Code Syntax</h1>The following options are available in the code section of the file:<br /> * <span class="codeInline">/**/</span> defines the anonymous marker (there can be only one). You can go to it with <span class="codeInline">goTo.marker();</span><br /> * <span class="codeInline">/*name*/</span> defines a marker called <i>name</i>. Valid marker names are any sequence of alphanumeric characters. You’ll go to it with <span class="codeInline">goTo.marker(‘name’);</span><br /> * <span class="codeInline">// @Filename: filename.ts</span> defines the filename of the following block of code. You can go to the file with <span class="codeInline">goTo.file(‘filename.ts’);</span>. You can also omit the filename and simply navigate to the files by their (0-based) index: <span class="codeInline">goTo.file(1);</span><br />We’ll be adding other metadata options (e.g. module compilation target) on an as-needed basis.<br />
<h1>Useful Tips</h1><ul><li>Use <span class="codeInline">debug.printCurrentFileState();</span> to show the current file state</li>
<li>Use <span class="codeInline">verify.not.</span> for verifying things which <i>shouldn&#39;t</i> appear</li>
<li>You can run a single fourslash test with <span class="codeInline">jake runtests tests=path\to\the\fourslashTest.ts</span></li>
<li>There are over 600 existing tests; refer to them if you&#39;re unsure how to do something</li></ul>

<h1>Various Notes</h1>Code is loaded as-is (minus marker removal), but is formatted during typing operations using the same formatting APIs as in Visual Studio. Marker positions will be maintained during edit operations unless they’re invalidated (e.g. a formatting operation deletes the surrounding characters). For convenience, a <span class="codeInline">////</span>’d comment block with a leading space in every line (not counting blank lines) will have exactly one leading space removed from each line.</div><div class="ClearBoth"></div>